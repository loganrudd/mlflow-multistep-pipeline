name: mlflow-multistep-pipeline

conda_env: conda.yaml

entry_points:
  load_raw_data:
    command: "dvc run -n load_raw_data -d load_raw_data.py -o data/raw/LoanStats3a.csv -o data/interim/loans.csv 'python load_raw_data.py'"

  etl_data:
    parameters:
      loans_csv_uri: path
    command: "dvc run -n etl_data -d etl_data.py -d data/interim/loans.csv -o data/processed/loans.parquet 'python etl_data.py --loans_csv_uri {loans_csv_uri}' "

  train_lgbm:
    parameters:
      loans_parquet_uri: path
      config:
        type: path
        default: config.yaml
    command: "dvc run -n train_lgbm -d train_lgbm.py -d data/processed/loans.parquet -d config.yaml 'python train_lgbm.py --loans_parquet_uri {loans_parquet_uri} --config {config}"

  main:
    parameters:
      split_prop: {type: float, default: 0.8}
    command: "dvc repro"

